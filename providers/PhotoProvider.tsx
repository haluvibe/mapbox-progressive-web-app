import React, { useState, useContext, useEffect } from "react";
import { fetchLicensePlate } from "../src/utils/fetchLicensePlate";

interface PhotoProviderProps {
  children: React.ReactNode;
}

interface PhotoContextValue {
  photo: Blob | null;
  setPhoto: (photo: Blob | null) => void;
  isLoading: boolean;
  hasLoaded: boolean;
  licensePlate: string;
  setLicensePlate: (license: string) => void;
  loadMockData: () => void;
}

const PhotoContext = React.createContext<PhotoContextValue | null>(null);

const usePhoto = () => {
  const context = useContext(PhotoContext);

  if (!context) {
    throw new Error("usePhoto must be used within a PhotoProvider");
  }

  const { photo, setPhoto, isLoading, hasLoaded, licensePlate, loadMockData } =
    context;

  return {
    photo,
    setPhoto,
    isLoading,
    hasLoaded,
    licensePlate,
    loadMockData,
  };
};

const PhotoProvider: React.FC<PhotoProviderProps> = ({ children }) => {
  const [photo, setPhotoState] = useState<Blob | null>(null);
  const [licensePlate, setLicensePlate] = useState("");
  const [isLoading, setIsLoading] = useState<boolean>(true);
  const [hasLoaded, setHasLoaded] = useState<boolean>(false);

  const loadMockData = () => {
    setHasLoaded(false);
    setIsLoading(true);

    const byteCharacters = atob(
      "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"
    );
    const byteNumbers = new Array(byteCharacters.length);
    for (let i = 0; i < byteCharacters.length; i++) {
      byteNumbers[i] = byteCharacters.charCodeAt(i);
    }
    const byteArray = new Uint8Array(byteNumbers);
    const blob = new Blob([byteArray], { type: "image/jpeg" });
    setPhotoState(blob);
    setLicensePlate("AO31BE");

    setTimeout(() => {
      setHasLoaded(true);
      setIsLoading(false);
    }, 1500);
  };

  const setPhoto = async (newPhoto: Blob | null) => {
    setHasLoaded(false);
    setIsLoading(true);

    setPhotoState(newPhoto);

    if (newPhoto) {
      const { license, parsedWords } = await fetchLicensePlate(newPhoto!);
      setLicensePlate(license ?? parsedWords);
    }

    setIsLoading(false);
    setHasLoaded(true);
  };

  useEffect(() => {
    if (!photo) {
      setHasLoaded(false);
      setIsLoading(true);
      return;
    }

    if (hasLoaded) {
      setIsLoading(false);
      return;
    }
  }, [photo]);

  const contextValue: PhotoContextValue = {
    photo,
    setPhoto,
    isLoading,
    hasLoaded,
    licensePlate,
    setLicensePlate,
    loadMockData,
  };

  return (
    <PhotoContext.Provider value={contextValue}>
      {children}
    </PhotoContext.Provider>
  );
};

export { PhotoProvider, usePhoto };
